!function(e,t,s,n){"use strict";t=void 0!==t&&t.Math==Math?t:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),e.fn.search=function(r){var i,a=e(this),c=a.selector||"",o=(new Date).getTime(),u=[],l=r,d="string"==typeof l,f=[].slice.call(arguments,1);return e(this).each((function(){var g=e.isPlainObject(r)?e.extend(!0,{},e.fn.search.settings,r):e.extend({},e.fn.search.settings),h=g.className,p=g.metadata,m=g.regExp,v=g.fields,y=g.selector,b=g.error,R=g.namespace,C="."+R,x=R+"-module",w=e(this),S=w.find(y.prompt),F=w.find(y.searchButton),j=w.find(y.results),T=w.find(y.result),k=(w.find(y.category),this),q=w.data(x),A=!1,E=!1,D={initialize:function(){D.verbose("Initializing module"),D.get.settings(),D.determine.searchFields(),D.bind.events(),D.set.type(),D.create.results(),D.instantiate()},instantiate:function(){D.verbose("Storing instance of module",D),q=D,w.data(x,D)},destroy:function(){D.verbose("Destroying instance"),w.off(C).removeData(x)},refresh:function(){D.debug("Refreshing selector cache"),S=w.find(y.prompt),F=w.find(y.searchButton),w.find(y.category),j=w.find(y.results),T=w.find(y.result)},refreshResults:function(){j=w.find(y.results),T=w.find(y.result)},bind:{events:function(){D.verbose("Binding events to search"),g.automatic&&(w.on(D.get.inputEvent()+C,y.prompt,D.event.input),S.attr("autocomplete","off")),w.on("focus"+C,y.prompt,D.event.focus).on("blur"+C,y.prompt,D.event.blur).on("keydown"+C,y.prompt,D.handleKeyboard).on("click"+C,y.searchButton,D.query).on("mousedown"+C,y.results,D.event.result.mousedown).on("mouseup"+C,y.results,D.event.result.mouseup).on("click"+C,y.result,D.event.result.click)}},determine:{searchFields:function(){r&&r.searchFields!==n&&(g.searchFields=r.searchFields)}},event:{input:function(){g.searchDelay?(clearTimeout(D.timer),D.timer=setTimeout((function(){D.is.focused()&&D.query()}),g.searchDelay)):D.query()},focus:function(){D.set.focus(),g.searchOnFocus&&D.has.minimumCharacters()&&D.query((function(){D.can.show()&&D.showResults()}))},blur:function(e){function t(){D.cancel.query(),D.remove.focus(),D.timer=setTimeout(D.hideResults,g.hideDelay)}s.activeElement===this||(E=!1,D.resultsClicked?(D.debug("Determining if user action caused search to close"),w.one("click.close"+C,y.results,(function(e){D.is.inMessage(e)||A?S.focus():(A=!1,D.is.animating()||D.is.hidden()||t())}))):(D.debug("Input blurred without user action, closing results"),t()))},result:{mousedown:function(){D.resultsClicked=!0},mouseup:function(){D.resultsClicked=!1},click:function(s){D.debug("Search result selected");var n=e(this),r=n.find(y.title).eq(0),i=n.is("a[href]")?n:n.find("a[href]").eq(0),a=i.attr("href")||!1,c=i.attr("target")||!1,o=(r.html(),0<r.length&&r.text()),u=D.get.results(),l=n.data(p.result)||D.get.result(o,u);if(e.isFunction(g.onSelect)&&!1===g.onSelect.call(k,l,u))return D.debug("Custom onSelect callback cancelled default select action"),void(A=!0);D.hideResults(),o&&D.set.value(o),a&&(D.verbose("Opening search link found in result",i),"_blank"==c||s.ctrlKey?t.open(a):t.location.href=a)}}},handleKeyboard:function(e){var t,s=w.find(y.result),n=w.find(y.category),r=s.filter("."+h.active),i=s.index(r),a=s.length,c=0<r.length,o=e.which;if(27==o&&(D.verbose("Escape key pressed, blurring search field"),D.hideResults(),E=!0),D.is.visible())if(13==o){if(D.verbose("Enter key pressed, selecting active result"),0<s.filter("."+h.active).length)return D.event.result.click.call(s.filter("."+h.active),e),e.preventDefault(),!1}else 38==o&&c?(D.verbose("Up key pressed, changing active result"),t=i-1<0?i:i-1,n.removeClass(h.active),s.removeClass(h.active).eq(t).addClass(h.active).closest(n).addClass(h.active),e.preventDefault()):40==o&&(D.verbose("Down key pressed, changing active result"),t=a<=i+1?i:i+1,n.removeClass(h.active),s.removeClass(h.active).eq(t).addClass(h.active).closest(n).addClass(h.active),e.preventDefault());else 13==o&&(D.verbose("Enter key pressed, executing query"),D.query(),D.set.buttonPressed(),S.one("keyup",D.remove.buttonFocus))},setup:{api:function(t,s){var n={debug:g.debug,on:!1,cache:g.cache,action:"search",urlData:{query:t},onSuccess:function(e){D.parse.response.call(k,e,t),s()},onFailure:function(){D.displayMessage(b.serverError),s()},onAbort:function(e){},onError:D.error};e.extend(!0,n,g.apiSettings),D.verbose("Setting up API request",n),w.api(n)}},can:{useAPI:function(){return e.fn.api!==n},show:function(){return D.is.focused()&&!D.is.visible()&&!D.is.empty()},transition:function(){return g.transition&&e.fn.transition!==n&&w.transition("is supported")}},is:{animating:function(){return j.hasClass(h.animating)},hidden:function(){return j.hasClass(h.hidden)},inMessage:function(t){if(t.target){var n=e(t.target);return e.contains(s.documentElement,t.target)&&0<n.closest(y.message).length}},empty:function(){return""===j.html()},visible:function(){return 0<j.filter(":visible").length},focused:function(){return 0<S.filter(":focus").length}},get:{settings:function(){e.isPlainObject(r)&&r.searchFullText&&(g.fullTextSearch=r.searchFullText,D.error(g.error.oldSearchSyntax,k))},inputEvent:function(){var e=S[0];return e!==n&&e.oninput!==n?"input":e!==n&&e.onpropertychange!==n?"propertychange":"keyup"},value:function(){return S.val()},results:function(){return w.data(p.results)},result:function(t,s){var r=["title","id"],i=!1;return t=t!==n?t:D.get.value(),s=s!==n?s:D.get.results(),"category"===g.type?(D.debug("Finding result that matches",t),e.each(s,(function(s,n){if(e.isArray(n.results)&&(i=D.search.object(t,n.results,r)[0]))return!1}))):(D.debug("Finding result in results object",t),i=D.search.object(t,s,r)[0]),i||!1}},select:{firstResult:function(){D.verbose("Selecting first result"),T.first().addClass(h.active)}},set:{focus:function(){w.addClass(h.focus)},loading:function(){w.addClass(h.loading)},value:function(e){D.verbose("Setting search input value",e),S.val(e)},type:function(e){e=e||g.type,"category"==g.type&&w.addClass(g.type)},buttonPressed:function(){F.addClass(h.pressed)}},remove:{loading:function(){w.removeClass(h.loading)},focus:function(){w.removeClass(h.focus)},buttonPressed:function(){F.removeClass(h.pressed)}},query:function(t){t=e.isFunction(t)?t:function(){};var s=D.get.value(),n=D.read.cache(s);t=t||function(){},D.has.minimumCharacters()?(n?(D.debug("Reading result from cache",s),D.save.results(n.results),D.addResults(n.html),D.inject.id(n.results),t()):(D.debug("Querying for",s),e.isPlainObject(g.source)||e.isArray(g.source)?(D.search.local(s),t()):D.can.useAPI()?D.search.remote(s,t):(D.error(b.source),t())),g.onSearchQuery.call(k,s)):D.hideResults()},search:{local:function(e){var t,s=D.search.object(e,g.content);D.set.loading(),D.save.results(s),D.debug("Returned full local search results",s),0<g.maxResults&&(D.debug("Using specified max results",s),s=s.slice(0,g.maxResults)),"category"==g.type&&(s=D.create.categoryResults(s)),t=D.generateResults({results:s}),D.remove.loading(),D.addResults(t),D.inject.id(s),D.write.cache(e,{html:t,results:s})},remote:function(t,s){s=e.isFunction(s)?s:function(){},w.api("is loading")&&w.api("abort"),D.setup.api(t,s),w.api("query")},object:function(t,s,r){function i(t,s){var n=-1==e.inArray(s,a),r=-1==e.inArray(s,o),i=-1==e.inArray(s,c);n&&r&&i&&t.push(s)}var a=[],c=[],o=[],u=t.toString().replace(m.escape,"\\$&"),l=new RegExp(m.beginsWith+u,"i");return s=s||g.source,r=r!==n?r:g.searchFields,e.isArray(r)||(r=[r]),s===n||!1===s?(D.error(b.source),[]):(e.each(r,(function(n,r){e.each(s,(function(e,s){"string"==typeof s[r]&&(-1!==s[r].search(l)?i(a,s):"exact"===g.fullTextSearch&&D.exactSearch(t,s[r])?i(c,s):1==g.fullTextSearch&&D.fuzzySearch(t,s[r])&&i(o,s))}))})),e.merge(c,o),e.merge(a,c),a)}},exactSearch:function(e,t){return e=e.toLowerCase(),-1<(t=t.toLowerCase()).indexOf(e)},fuzzySearch:function(e,t){var s=t.length,n=e.length;if("string"!=typeof e)return!1;if(e=e.toLowerCase(),t=t.toLowerCase(),s<n)return!1;if(n===s)return e===t;e:for(var r=0,i=0;r<n;r++){for(var a=e.charCodeAt(r);i<s;)if(t.charCodeAt(i++)===a)continue e;return!1}return!0},parse:{response:function(e,t){var s=D.generateResults(e);D.verbose("Parsing server response",e),e!==n&&t!==n&&e[v.results]!==n&&(D.addResults(s),D.inject.id(e[v.results]),D.write.cache(t,{html:s,results:e[v.results]}),D.save.results(e[v.results]))}},cancel:{query:function(){D.can.useAPI()&&w.api("abort")}},has:{minimumCharacters:function(){return D.get.value().length>=g.minCharacters},results:function(){return 0!==j.length&&""!=j.html()}},clear:{cache:function(e){var t=w.data(p.cache);e?e&&t&&t[e]&&(D.debug("Removing value from cache",e),delete t[e],w.data(p.cache,t)):(D.debug("Clearing cache",e),w.removeData(p.cache))}},read:{cache:function(e){var t=w.data(p.cache);return!!g.cache&&(D.verbose("Checking cache for generated html for query",e),"object"==typeof t&&t[e]!==n&&t[e])}},create:{categoryResults:function(t){var s={};return e.each(t,(function(e,t){t.category&&(s[t.category]===n?(D.verbose("Creating new category of results",t.category),s[t.category]={name:t.category,results:[t]}):s[t.category].results.push(t))})),s},id:function(e,t){var s,r=e+1;return t!==n?(s=String.fromCharCode(97+t)+r,D.verbose("Creating category result id",s)):(s=r,D.verbose("Creating result id",s)),s},results:function(){0===j.length&&(j=e("<div />").addClass(h.results).appendTo(w))}},inject:{result:function(e,t,s){D.verbose("Injecting result into results");var r=s!==n?j.children().eq(s).children(y.results).first().children(y.result).eq(t):j.children(y.result).eq(t);D.verbose("Injecting results metadata",r),r.data(p.result,e)},id:function(t){D.debug("Injecting unique ids into results");var s=0,r=0;return"category"===g.type?e.each(t,(function(t,i){r=0,e.each(i.results,(function(e,t){var a=i.results[e];a.id===n&&(a.id=D.create.id(r,s)),D.inject.result(a,r,s),r++})),s++})):e.each(t,(function(e,s){var i=t[e];i.id===n&&(i.id=D.create.id(r)),D.inject.result(i,r),r++})),t}},save:{results:function(e){D.verbose("Saving current search results to metadata",e),w.data(p.results,e)}},write:{cache:function(e,t){var s=w.data(p.cache)!==n?w.data(p.cache):{};g.cache&&(D.verbose("Writing generated html to cache",e,t),s[e]=t,w.data(p.cache,s))}},addResults:function(t){if(e.isFunction(g.onResultsAdd)&&!1===g.onResultsAdd.call(j,t))return D.debug("onResultsAdd callback cancelled default action"),!1;t?(j.html(t),D.refreshResults(),g.selectFirstResult&&D.select.firstResult(),D.showResults()):D.hideResults((function(){j.empty()}))},showResults:function(t){t=e.isFunction(t)?t:function(){},E||!D.is.visible()&&D.has.results()&&(D.can.transition()?(D.debug("Showing results with css animations"),j.transition({animation:g.transition+" in",debug:g.debug,verbose:g.verbose,duration:g.duration,onComplete:function(){t()},queue:!0})):(D.debug("Showing results with javascript"),j.stop().fadeIn(g.duration,g.easing)),g.onResultsOpen.call(j))},hideResults:function(t){t=e.isFunction(t)?t:function(){},D.is.visible()&&(D.can.transition()?(D.debug("Hiding results with css animations"),j.transition({animation:g.transition+" out",debug:g.debug,verbose:g.verbose,duration:g.duration,onComplete:function(){t()},queue:!0})):(D.debug("Hiding results with javascript"),j.stop().fadeOut(g.duration,g.easing)),g.onResultsClose.call(j))},generateResults:function(t){D.debug("Generating html from response",t);var s=g.templates[g.type],n=e.isPlainObject(t[v.results])&&!e.isEmptyObject(t[v.results]),r=e.isArray(t[v.results])&&0<t[v.results].length,i="";return n||r?(0<g.maxResults&&(n?"standard"==g.type&&D.error(b.maxResults):t[v.results]=t[v.results].slice(0,g.maxResults)),e.isFunction(s)?i=s(t,v):D.error(b.noTemplate,!1)):g.showNoResults&&(i=D.displayMessage(b.noResults,"empty")),g.onResults.call(k,t),i},displayMessage:function(e,t){return t=t||"standard",D.debug("Displaying message",e,t),D.addResults(g.templates.message(e,t)),g.templates.message(e,t)},setting:function(t,s){if(e.isPlainObject(t))e.extend(!0,g,t);else{if(s===n)return g[t];g[t]=s}},internal:function(t,s){if(e.isPlainObject(t))e.extend(!0,D,t);else{if(s===n)return D[t];D[t]=s}},debug:function(){!g.silent&&g.debug&&(g.performance?D.performance.log(arguments):(D.debug=Function.prototype.bind.call(console.info,console,g.name+":"),D.debug.apply(console,arguments)))},verbose:function(){!g.silent&&g.verbose&&g.debug&&(g.performance?D.performance.log(arguments):(D.verbose=Function.prototype.bind.call(console.info,console,g.name+":"),D.verbose.apply(console,arguments)))},error:function(){g.silent||(D.error=Function.prototype.bind.call(console.error,console,g.name+":"),D.error.apply(console,arguments))},performance:{log:function(e){var t,s;g.performance&&(s=(t=(new Date).getTime())-(o||t),o=t,u.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:k,"Execution Time":s})),clearTimeout(D.performance.timer),D.performance.timer=setTimeout(D.performance.display,500)},display:function(){var t=g.name+":",s=0;o=!1,clearTimeout(D.performance.timer),e.each(u,(function(e,t){s+=t["Execution Time"]})),t+=" "+s+"ms",c&&(t+=" '"+c+"'"),1<a.length&&(t+=" ("+a.length+")"),(console.group!==n||console.table!==n)&&0<u.length&&(console.groupCollapsed(t),console.table?console.table(u):e.each(u,(function(e,t){t.Name,t["Execution Time"]})),console.groupEnd()),u=[]}},invoke:function(t,s,r){var a,c,o,u=q;return s=s||f,r=k||r,"string"==typeof t&&u!==n&&(t=t.split(/[\. ]/),a=t.length-1,e.each(t,(function(s,r){var i=s!=a?r+t[s+1].charAt(0).toUpperCase()+t[s+1].slice(1):t;if(e.isPlainObject(u[i])&&s!=a)u=u[i];else{if(u[i]!==n)return c=u[i],!1;if(!e.isPlainObject(u[r])||s==a)return u[r]!==n&&(c=u[r]),!1;u=u[r]}}))),e.isFunction(c)?o=c.apply(r,s):c!==n&&(o=c),e.isArray(i)?i.push(o):i!==n?i=[i,o]:o!==n&&(i=o),c}};d?(q===n&&D.initialize(),D.invoke(l)):(q!==n&&q.invoke("destroy"),D.initialize())})),i!==n?i:this},e.fn.search.settings={name:"Search",namespace:"search",silent:!1,debug:!1,verbose:!1,performance:!0,type:"standard",minCharacters:1,selectFirstResult:!1,apiSettings:!1,source:!1,searchOnFocus:!0,searchFields:["title","description"],displayField:"",fullTextSearch:"exact",automatic:!0,hideDelay:0,searchDelay:200,maxResults:7,cache:!0,showNoResults:!0,transition:"scale",duration:200,easing:"easeOutExpo",onSelect:!1,onResultsAdd:!1,onSearchQuery:function(e){},onResults:function(e){},onResultsOpen:function(){},onResultsClose:function(){},className:{animating:"animating",active:"active",empty:"empty",focus:"focus",hidden:"hidden",loading:"loading",results:"results",pressed:"down"},error:{source:"Cannot search. No source used, and Semantic API module was not included",noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noEndpoint:"No search endpoint was specified",noTemplate:"A valid template name was not specified.",oldSearchSyntax:"searchFullText setting has been renamed fullTextSearch for consistency, please adjust your settings.",serverError:"There was an issue querying the server.",maxResults:"Results must be an array to use maxResults setting",method:"The method you called is not defined."},metadata:{cache:"cache",results:"results",result:"result"},regExp:{escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,beginsWith:"(?:s|^)"},fields:{categories:"results",categoryName:"name",categoryResults:"results",description:"description",image:"image",price:"price",results:"results",title:"title",url:"url",action:"action",actionText:"text",actionURL:"url"},selector:{prompt:".prompt",searchButton:".search.button",results:".results",message:".results > .message",category:".category",result:".result",title:".title, .name"},templates:{escape:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};return/[&<>"'`]/.test(e)?e.replace(/[&<>"'`]/g,(function(e){return t[e]})):e},message:function(e,t){var s="";return e!==n&&t!==n&&(s+='<div class="message '+t+'">',s+="empty"==t?'<div class="header">No Results</div class="header"><div class="description">'+e+'</div class="description">':' <div class="description">'+e+"</div>",s+="</div>"),s},category:function(t,s){var r="";return e.fn.search.settings.templates.escape,t[s.categoryResults]!==n&&(e.each(t[s.categoryResults],(function(t,i){i[s.results]!==n&&0<i.results.length&&(r+='<div class="category">',i[s.categoryName]!==n&&(r+='<div class="name">'+i[s.categoryName]+"</div>"),r+='<div class="results">',e.each(i.results,(function(e,t){t[s.url]?r+='<a class="result" href="'+t[s.url]+'">':r+='<a class="result">',t[s.image]!==n&&(r+='<div class="image"> <img src="'+t[s.image]+'"></div>'),r+='<div class="content">',t[s.price]!==n&&(r+='<div class="price">'+t[s.price]+"</div>"),t[s.title]!==n&&(r+='<div class="title">'+t[s.title]+"</div>"),t[s.description]!==n&&(r+='<div class="description">'+t[s.description]+"</div>"),r+="</div>",r+="</a>"})),r+="</div>",r+="</div>")})),t[s.action]&&(r+='<a href="'+t[s.action][s.actionURL]+'" class="action">'+t[s.action][s.actionText]+"</a>"),r)},standard:function(t,s){var r="";return t[s.results]!==n&&(e.each(t[s.results],(function(e,t){t[s.url]?r+='<a class="result" href="'+t[s.url]+'">':r+='<a class="result">',t[s.image]!==n&&(r+='<div class="image"> <img src="'+t[s.image]+'"></div>'),r+='<div class="content">',t[s.price]!==n&&(r+='<div class="price">'+t[s.price]+"</div>"),t[s.title]!==n&&(r+='<div class="title">'+t[s.title]+"</div>"),t[s.description]!==n&&(r+='<div class="description">'+t[s.description]+"</div>"),r+="</div>",r+="</a>"})),t[s.action]&&(r+='<a href="'+t[s.action][s.actionURL]+'" class="action">'+t[s.action][s.actionText]+"</a>"),r)}}}}(jQuery,window,document);