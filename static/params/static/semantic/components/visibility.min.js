!function(e,o,n,t){"use strict";o=void 0!==o&&o.Math==Math?o:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),e.fn.visibility=function(i){var s,c=e(this),r=c.selector||"",a=(new Date).getTime(),l=[],d=i,u="string"==typeof d,f=[].slice.call(arguments,1),b=c.length,g=0;return c.each((function(){var c,m,p,v=e.isPlainObject(i)?e.extend(!0,{},e.fn.visibility.settings,i):e.extend({},e.fn.visibility.settings),h=v.className,P=v.namespace,x=v.error,C=v.metadata,y="."+P,S="module-"+P,R=e(o),V=e(this),k=e(v.context),T=(V.selector,V.data(S)),O=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||o.msRequestAnimationFrame||function(e){setTimeout(e,0)},z=this,A=!1,w={initialize:function(){w.debug("Initializing",v),w.setup.cache(),w.should.trackChanges()&&("image"==v.type&&w.setup.image(),"fixed"==v.type&&w.setup.fixed(),v.observeChanges&&w.observeChanges(),w.bind.events()),w.save.position(),w.is.visible()||w.error(x.visible,V),v.initialCheck&&w.checkVisibility(),w.instantiate()},instantiate:function(){w.debug("Storing instance",w),V.data(S,w),T=w},destroy:function(){w.verbose("Destroying previous module"),p&&p.disconnect(),m&&m.disconnect(),R.off("load"+y,w.event.load).off("resize"+y,w.event.resize),k.off("scroll"+y,w.event.scroll).off("scrollchange"+y,w.event.scrollchange),"fixed"==v.type&&(w.resetFixed(),w.remove.placeholder()),V.off(y).removeData(S)},observeChanges:function(){"MutationObserver"in o&&(m=new MutationObserver(w.event.contextChanged),p=new MutationObserver(w.event.changed),m.observe(n,{childList:!0,subtree:!0}),p.observe(z,{childList:!0,subtree:!0}),w.debug("Setting up mutation observer",p))},bind:{events:function(){w.verbose("Binding visibility events to scroll and resize"),v.refreshOnLoad&&R.on("load"+y,w.event.load),R.on("resize"+y,w.event.resize),k.off("scroll"+y).on("scroll"+y,w.event.scroll).on("scrollchange"+y,w.event.scrollchange)}},event:{changed:function(e){w.verbose("DOM tree modified, updating visibility calculations"),w.timer=setTimeout((function(){w.verbose("DOM tree modified, updating sticky menu"),w.refresh()}),100)},contextChanged:function(o){[].forEach.call(o,(function(o){o.removedNodes&&[].forEach.call(o.removedNodes,(function(o){(o==z||0<e(o).find(z).length)&&(w.debug("Element removed from DOM, tearing down events"),w.destroy())}))}))},resize:function(){w.debug("Window resized"),v.refreshOnResize&&O(w.refresh)},load:function(){w.debug("Page finished loading"),O(w.refresh)},scroll:function(){v.throttle?(clearTimeout(w.timer),w.timer=setTimeout((function(){k.triggerHandler("scrollchange"+y,[k.scrollTop()])}),v.throttle)):O((function(){k.triggerHandler("scrollchange"+y,[k.scrollTop()])}))},scrollchange:function(e,o){w.checkVisibility(o)}},precache:function(o,t){o instanceof Array||(o=[o]);for(var i=o.length,s=0,c=[],r=n.createElement("img"),a=function(){++s>=o.length&&e.isFunction(t)&&t()};i--;)(r=n.createElement("img")).onload=a,r.onerror=a,r.src=o[i],c.push(r)},enableCallbacks:function(){w.debug("Allowing callbacks to occur"),A=!1},disableCallbacks:function(){w.debug("Disabling all callbacks temporarily"),A=!0},should:{trackChanges:function(){return u?(w.debug("One time query, no need to bind events"),!1):(w.debug("Callbacks being attached"),!0)}},setup:{cache:function(){w.cache={occurred:{},screen:{},element:{}}},image:function(){var e=V.data(C.src);e&&(w.verbose("Lazy loading image",e),v.once=!0,v.observeChanges=!1,v.onOnScreen=function(){w.debug("Image on screen",z),w.precache(e,(function(){w.set.image(e,(function(){++g==b&&v.onAllLoaded.call(this),v.onLoad.call(this)}))}))})},fixed:function(){w.debug("Setting up fixed"),v.once=!1,v.observeChanges=!1,v.initialCheck=!0,v.refreshOnLoad=!0,i.transition||(v.transition=!1),w.create.placeholder(),w.debug("Added placeholder",c),v.onTopPassed=function(){w.debug("Element passed, adding fixed position",V),w.show.placeholder(),w.set.fixed(),v.transition&&e.fn.transition!==t&&V.transition(v.transition,v.duration)},v.onTopPassedReverse=function(){w.debug("Element returned to position, removing fixed",V),w.hide.placeholder(),w.remove.fixed()}}},create:{placeholder:function(){w.verbose("Creating fixed position placeholder"),c=V.clone(!1).css("display","none").addClass(h.placeholder).insertAfter(V)}},show:{placeholder:function(){w.verbose("Showing placeholder"),c.css("display","block").css("visibility","hidden")}},hide:{placeholder:function(){w.verbose("Hiding placeholder"),c.css("display","none").css("visibility","")}},set:{fixed:function(){w.verbose("Setting element to fixed position"),V.addClass(h.fixed).css({position:"fixed",top:v.offset+"px",left:"auto",zIndex:v.zIndex}),v.onFixed.call(z)},image:function(o,n){if(V.attr("src",o),v.transition)if(e.fn.transition!==t){if(V.hasClass(h.visible))return void w.debug("Transition already occurred on this image, skipping animation");V.transition(v.transition,v.duration,n)}else V.fadeIn(v.duration,n);else V.show()}},is:{onScreen:function(){return w.get.elementCalculations().onScreen},offScreen:function(){return w.get.elementCalculations().offScreen},visible:function(){return!(!w.cache||!w.cache.element||0===w.cache.element.width&&0===w.cache.element.offset.top)},verticallyScrollableContext:function(){var e=k.get(0)!==o&&k.css("overflow-y");return"auto"==e||"scroll"==e},horizontallyScrollableContext:function(){var e=k.get(0)!==o&&k.css("overflow-x");return"auto"==e||"scroll"==e}},refresh:function(){w.debug("Refreshing constants (width/height)"),"fixed"==v.type&&w.resetFixed(),w.reset(),w.save.position(),v.checkOnRefresh&&w.checkVisibility(),v.onRefresh.call(z)},resetFixed:function(){w.remove.fixed(),w.remove.occurred()},reset:function(){w.verbose("Resetting all cached values"),e.isPlainObject(w.cache)&&(w.cache.screen={},w.cache.element={})},checkVisibility:function(e){w.verbose("Checking visibility of element",w.cache.element),!A&&w.is.visible()&&(w.save.scroll(e),w.save.calculations(),w.passed(),w.passingReverse(),w.topVisibleReverse(),w.bottomVisibleReverse(),w.topPassedReverse(),w.bottomPassedReverse(),w.onScreen(),w.offScreen(),w.passing(),w.topVisible(),w.bottomVisible(),w.topPassed(),w.bottomPassed(),v.onUpdate&&v.onUpdate.call(z,w.get.elementCalculations()))},passed:function(o,n){var i=w.get.elementCalculations();if(o&&n)v.onPassed[o]=n;else{if(o!==t)return w.get.pixelsPassed(o)>i.pixelsPassed;i.passing&&e.each(v.onPassed,(function(e,o){i.bottomVisible||i.pixelsPassed>w.get.pixelsPassed(e)?w.execute(o,e):v.once||w.remove.occurred(o)}))}},onScreen:function(e){var o=w.get.elementCalculations(),n=e||v.onOnScreen,i="onScreen";if(e&&(w.debug("Adding callback for onScreen",e),v.onOnScreen=e),o.onScreen?w.execute(n,i):v.once||w.remove.occurred(i),e!==t)return o.onOnScreen},offScreen:function(e){var o=w.get.elementCalculations(),n=e||v.onOffScreen,i="offScreen";if(e&&(w.debug("Adding callback for offScreen",e),v.onOffScreen=e),o.offScreen?w.execute(n,i):v.once||w.remove.occurred(i),e!==t)return o.onOffScreen},passing:function(e){var o=w.get.elementCalculations(),n=e||v.onPassing,i="passing";if(e&&(w.debug("Adding callback for passing",e),v.onPassing=e),o.passing?w.execute(n,i):v.once||w.remove.occurred(i),e!==t)return o.passing},topVisible:function(e){var o=w.get.elementCalculations(),n=e||v.onTopVisible,i="topVisible";if(e&&(w.debug("Adding callback for top visible",e),v.onTopVisible=e),o.topVisible?w.execute(n,i):v.once||w.remove.occurred(i),e===t)return o.topVisible},bottomVisible:function(e){var o=w.get.elementCalculations(),n=e||v.onBottomVisible,i="bottomVisible";if(e&&(w.debug("Adding callback for bottom visible",e),v.onBottomVisible=e),o.bottomVisible?w.execute(n,i):v.once||w.remove.occurred(i),e===t)return o.bottomVisible},topPassed:function(e){var o=w.get.elementCalculations(),n=e||v.onTopPassed,i="topPassed";if(e&&(w.debug("Adding callback for top passed",e),v.onTopPassed=e),o.topPassed?w.execute(n,i):v.once||w.remove.occurred(i),e===t)return o.topPassed},bottomPassed:function(e){var o=w.get.elementCalculations(),n=e||v.onBottomPassed,i="bottomPassed";if(e&&(w.debug("Adding callback for bottom passed",e),v.onBottomPassed=e),o.bottomPassed?w.execute(n,i):v.once||w.remove.occurred(i),e===t)return o.bottomPassed},passingReverse:function(e){var o=w.get.elementCalculations(),n=e||v.onPassingReverse,i="passingReverse";if(e&&(w.debug("Adding callback for passing reverse",e),v.onPassingReverse=e),o.passing?v.once||w.remove.occurred(i):w.get.occurred("passing")&&w.execute(n,i),e!==t)return!o.passing},topVisibleReverse:function(e){var o=w.get.elementCalculations(),n=e||v.onTopVisibleReverse,i="topVisibleReverse";if(e&&(w.debug("Adding callback for top visible reverse",e),v.onTopVisibleReverse=e),o.topVisible?v.once||w.remove.occurred(i):w.get.occurred("topVisible")&&w.execute(n,i),e===t)return!o.topVisible},bottomVisibleReverse:function(e){var o=w.get.elementCalculations(),n=e||v.onBottomVisibleReverse,i="bottomVisibleReverse";if(e&&(w.debug("Adding callback for bottom visible reverse",e),v.onBottomVisibleReverse=e),o.bottomVisible?v.once||w.remove.occurred(i):w.get.occurred("bottomVisible")&&w.execute(n,i),e===t)return!o.bottomVisible},topPassedReverse:function(e){var o=w.get.elementCalculations(),n=e||v.onTopPassedReverse,i="topPassedReverse";if(e&&(w.debug("Adding callback for top passed reverse",e),v.onTopPassedReverse=e),o.topPassed?v.once||w.remove.occurred(i):w.get.occurred("topPassed")&&w.execute(n,i),e===t)return!o.onTopPassed},bottomPassedReverse:function(e){var o=w.get.elementCalculations(),n=e||v.onBottomPassedReverse,i="bottomPassedReverse";if(e&&(w.debug("Adding callback for bottom passed reverse",e),v.onBottomPassedReverse=e),o.bottomPassed?v.once||w.remove.occurred(i):w.get.occurred("bottomPassed")&&w.execute(n,i),e===t)return!o.bottomPassed},execute:function(e,o){var n=w.get.elementCalculations(),t=w.get.screenCalculations();(e=e||!1)&&(v.continuous?(w.debug("Callback being called continuously",o,n),e.call(z,n,t)):w.get.occurred(o)||(w.debug("Conditions met",o,n),e.call(z,n,t))),w.save.occurred(o)},remove:{fixed:function(){w.debug("Removing fixed position"),V.removeClass(h.fixed).css({position:"",top:"",left:"",zIndex:""}),v.onUnfixed.call(z)},placeholder:function(){w.debug("Removing placeholder content"),c&&c.remove()},occurred:function(e){var o;e?(o=w.cache.occurred)[e]!==t&&!0===o[e]&&(w.debug("Callback can now be called again",e),w.cache.occurred[e]=!1):w.cache.occurred={}}},save:{calculations:function(){w.verbose("Saving all calculations necessary to determine positioning"),w.save.direction(),w.save.screenCalculations(),w.save.elementCalculations()},occurred:function(e){e&&(w.cache.occurred[e]!==t&&!0===w.cache.occurred[e]||(w.verbose("Saving callback occurred",e),w.cache.occurred[e]=!0))},scroll:function(e){e=e+v.offset||k.scrollTop()+v.offset,w.cache.scroll=e},direction:function(){var e=w.get.scroll(),o=w.get.lastScroll(),n=o<e&&o?"down":e<o&&o?"up":"static";return w.cache.direction=n,w.cache.direction},elementPosition:function(){var e=w.cache.element,o=w.get.screenSize();return w.verbose("Saving element position"),e.fits=e.height<o.height,e.offset=V.offset(),e.width=V.outerWidth(),e.height=V.outerHeight(),w.is.verticallyScrollableContext()&&(e.offset.top+=k.scrollTop()-k.offset().top),w.is.horizontallyScrollableContext()&&(e.offset.left+=k.scrollLeft-k.offset().left),w.cache.element=e},elementCalculations:function(){var e=w.get.screenCalculations(),o=w.get.elementPosition();return v.includeMargin?(o.margin={},o.margin.top=parseInt(V.css("margin-top"),10),o.margin.bottom=parseInt(V.css("margin-bottom"),10),o.top=o.offset.top-o.margin.top,o.bottom=o.offset.top+o.height+o.margin.bottom):(o.top=o.offset.top,o.bottom=o.offset.top+o.height),o.topPassed=e.top>=o.top,o.bottomPassed=e.top>=o.bottom,o.topVisible=e.bottom>=o.top&&!o.topPassed,o.bottomVisible=e.bottom>=o.bottom&&!o.bottomPassed,o.pixelsPassed=0,o.percentagePassed=0,o.onScreen=(o.topVisible||o.passing)&&!o.bottomPassed,o.passing=o.topPassed&&!o.bottomPassed,o.offScreen=!o.onScreen,o.passing&&(o.pixelsPassed=e.top-o.top,o.percentagePassed=(e.top-o.top)/o.height),w.cache.element=o,w.verbose("Updated element calculations",o),o},screenCalculations:function(){var e=w.get.scroll();return w.save.direction(),w.cache.screen.top=e,w.cache.screen.bottom=e+w.cache.screen.height,w.cache.screen},screenSize:function(){w.verbose("Saving window position"),w.cache.screen={height:k.height()}},position:function(){w.save.screenSize(),w.save.elementPosition()}},get:{pixelsPassed:function(e){var o=w.get.elementCalculations();return-1<e.search("%")?o.height*(parseInt(e,10)/100):parseInt(e,10)},occurred:function(e){return w.cache.occurred!==t&&w.cache.occurred[e]||!1},direction:function(){return w.cache.direction===t&&w.save.direction(),w.cache.direction},elementPosition:function(){return w.cache.element===t&&w.save.elementPosition(),w.cache.element},elementCalculations:function(){return w.cache.element===t&&w.save.elementCalculations(),w.cache.element},screenCalculations:function(){return w.cache.screen===t&&w.save.screenCalculations(),w.cache.screen},screenSize:function(){return w.cache.screen===t&&w.save.screenSize(),w.cache.screen},scroll:function(){return w.cache.scroll===t&&w.save.scroll(),w.cache.scroll},lastScroll:function(){return w.cache.screen===t?(w.debug("First scroll event, no last scroll could be found"),!1):w.cache.screen.top}},setting:function(o,n){if(e.isPlainObject(o))e.extend(!0,v,o);else{if(n===t)return v[o];v[o]=n}},internal:function(o,n){if(e.isPlainObject(o))e.extend(!0,w,o);else{if(n===t)return w[o];w[o]=n}},debug:function(){!v.silent&&v.debug&&(v.performance?w.performance.log(arguments):(w.debug=Function.prototype.bind.call(console.info,console,v.name+":"),w.debug.apply(console,arguments)))},verbose:function(){!v.silent&&v.verbose&&v.debug&&(v.performance?w.performance.log(arguments):(w.verbose=Function.prototype.bind.call(console.info,console,v.name+":"),w.verbose.apply(console,arguments)))},error:function(){v.silent||(w.error=Function.prototype.bind.call(console.error,console,v.name+":"),w.error.apply(console,arguments))},performance:{log:function(e){var o,n;v.performance&&(n=(o=(new Date).getTime())-(a||o),a=o,l.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:z,"Execution Time":n})),clearTimeout(w.performance.timer),w.performance.timer=setTimeout(w.performance.display,500)},display:function(){var o=v.name+":",n=0;a=!1,clearTimeout(w.performance.timer),e.each(l,(function(e,o){n+=o["Execution Time"]})),o+=" "+n+"ms",r&&(o+=" '"+r+"'"),(console.group!==t||console.table!==t)&&0<l.length&&(console.groupCollapsed(o),console.table?console.table(l):e.each(l,(function(e,o){o.Name,o["Execution Time"]})),console.groupEnd()),l=[]}},invoke:function(o,n,i){var c,r,a,l=T;return n=n||f,i=z||i,"string"==typeof o&&l!==t&&(o=o.split(/[\. ]/),c=o.length-1,e.each(o,(function(n,i){var s=n!=c?i+o[n+1].charAt(0).toUpperCase()+o[n+1].slice(1):o;if(e.isPlainObject(l[s])&&n!=c)l=l[s];else{if(l[s]!==t)return r=l[s],!1;if(!e.isPlainObject(l[i])||n==c)return l[i]!==t?r=l[i]:w.error(x.method,o),!1;l=l[i]}}))),e.isFunction(r)?a=r.apply(i,n):r!==t&&(a=r),e.isArray(s)?s.push(a):s!==t?s=[s,a]:a!==t&&(s=a),r}};u?(T===t&&w.initialize(),T.save.scroll(),T.save.calculations(),w.invoke(d)):(T!==t&&T.invoke("destroy"),w.initialize())})),s!==t?s:this},e.fn.visibility.settings={name:"Visibility",namespace:"visibility",debug:!1,verbose:!1,performance:!0,observeChanges:!0,initialCheck:!0,refreshOnLoad:!0,refreshOnResize:!0,checkOnRefresh:!0,once:!0,continuous:!1,offset:0,includeMargin:!1,context:o,throttle:!1,type:!1,zIndex:"10",transition:"fade in",duration:1e3,onPassed:{},onOnScreen:!1,onOffScreen:!1,onPassing:!1,onTopVisible:!1,onBottomVisible:!1,onTopPassed:!1,onBottomPassed:!1,onPassingReverse:!1,onTopVisibleReverse:!1,onBottomVisibleReverse:!1,onTopPassedReverse:!1,onBottomPassedReverse:!1,onLoad:function(){},onAllLoaded:function(){},onFixed:function(){},onUnfixed:function(){},onUpdate:!1,onRefresh:function(){},metadata:{src:"src"},className:{fixed:"fixed",placeholder:"placeholder",visible:"visible"},error:{method:"The method you called is not defined.",visible:"Element is hidden, you must call refresh after element becomes visible"}}}(jQuery,window,document);